

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 4 - Cleaning Data &#8212; Pomona Psych 158 Online Textbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter-4';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Pomona College Psych 158 Online Textbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Unit 1 Describing Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-1.ipynb">Chapter 1 - Introduction to Statistical Thinking</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-2.ipynb">Chapter 2 - What are Data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-3.ipynb">Chapter 3 - Organizing Data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-4.ipynb">Chapter 4 - Cleaning Data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-5.ipynb">Chapter 5 - Describing Data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-6.ipynb">Chapter 6 - Variation in Multiple Variables</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-7.ipynb">Chapter 7 - Principles of Data Visualization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Unit 2 - Modeling Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-8.ipynb">Chapter 8 - Where Data Come From</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-9.ipynb">Chapter 9 - Modeling the Data Generation Process</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-10.ipynb">Chapter 10 - Quantifying Model Error</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-11.ipynb">Chapter 11 - Adding an Explanatory Variable</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-12.ipynb">Chapter 12 - Quantitative Predictor Models</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-13.ipynb">Chapter 13 - Multivariable Models</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-14.ipynb">Chapter 14 - Models with Moderation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Unit 3 - Evaluating Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-15.ipynb">Chapter 15 - Estimating Populations</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-16.ipynb">Chapter 16 - Significance Testing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-17.ipynb">Chapter 17 - Significance Testing Whole Models</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-18.ipynb">Chapter 18 - Effect Sizes &amp; Statistical Power</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-19.ipynb">Chapter 19 - Bias due to Improper Model Building</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-20.ipynb">Chapter 20 - Alternate Approaches - Traditional Statistical Tools</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-21.ipynb">Chapter 21 - Alternative Approaches - Bayesian Statistics</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-22.ipynb">Chapter 22 - Lying with Statistics</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/smburns47/Psyc158/main?urlpath=tree/chapter-4.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/smburns47/Psyc158" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/smburns47/Psyc158/issues/new?title=Issue%20on%20page%20%2Fchapter-4.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chapter-4.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 4 - Cleaning Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subsetting-data">4.1 Subsetting data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-bad-data">4.2 Filtering bad data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-variables">4.3 Creating new variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recoding-variables">4.4 Recoding variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-multiple-cleaning-steps">4.5 Combining multiple cleaning steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-data">4.6 Saving data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-summary">Chapter summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-concepts">New concepts</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><a class="reference external" href="https://www.shannonmburns.com/Psyc158/intro.html">Back to Table of Contents</a></p>
<p><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-3.ipynb">Previous: Chapter 3 - Organizing Data</a></p>
<section class="tex2jax_ignore mathjax_ignore" id="chapter-4-cleaning-data">
<h1>Chapter 4 - Cleaning Data<a class="headerlink" href="#chapter-4-cleaning-data" title="Permalink to this heading">#</a></h1>
<p>The scientific study of humans is a messy process. They don’t always understand what we’re asking in a survey, or do what we want them to do in a behavioral study. Some people are nervous of looking a certain way, so will answer questions not as they truly believe but as they want other people to think of them. Other people just want to finish the study as fast as possible and get paid, so they complete tasks without paying much attention. Sometimes, participants don’t want to answer a question at all. Other times we the researchers made a mistake in creating the study in the first place.</p>
<p>For these reasons, the preparation of human data for analysis - called <strong>data cleaning</strong> - is an important skill. It is the process of reorganizing a dataset so that it most closely resembles the true values we want to analyze, in a format that works for our chosen analysis process. Data cleaning is also a time consuming process. Analysis of any research study is often 80%+ data cleaning with a much smaller proportion of time dedicated to running models or testing hypotheses.</p>
<p>The difference between clean and dirty data can be the difference between a successful research study and noisy data that no one can understand. In this chapter, we will spend time learning the most helpful data cleaning steps for psychological data.</p>
<section id="subsetting-data">
<h2>4.1 Subsetting data<a class="headerlink" href="#subsetting-data" title="Permalink to this heading">#</a></h2>
<p>Some research studies are simple to conduct, with just a couple variables recorded. Other studies can be massive endeavors with many variables collected at once for the purpose of several different hypotheses.</p>
<p>For example, the <a class="reference external" href="https://gss.norc.org/">General Social Survey</a> is a nationally representative survey run every year in the US since 1972. It collects data from hundreds of thousands of people on hundreds of variables, including demographics, behaviors, and attitudes relevant to US society. It has provided data for more than 130 research papers that all studied a different hypothesis.</p>
<p>That’s a lot of data to manage! For this reason, sometimes you want to focus on viewing only a subset of your variables in a data frame. To continue our use of the <code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code> dataset from last chapter, you might care about only the hypothesis regarding different study conditions affecting number of intrusive memories, and thus only the variables <code class="docutils literal notranslate"><span class="pre">condition</span></code> and <code class="docutils literal notranslate"><span class="pre">instrusive_memories</span></code>. The data frame would be easier to read if it only included these variables and not all the others. Let’s open up that dataset and see where these variables are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">filepath</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;https://raw.githubusercontent.com/smburns47/Psyc158/main/tetrismemories.csv&quot;</span>

<span class="c1">#write code here to load the data into an object called tetrismemories</span>
<span class="n">tetrismemories</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="c1">#your code here</span>

<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By counting columns from the left, we can see that <code class="docutils literal notranslate"><span class="pre">condition</span></code> is the first column and <code class="docutils literal notranslate"><span class="pre">intrusive_memories</span></code> is the 16th column. Thus, one way we can subset our data is by indexing the data frame to just those column numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tetrismemories</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">16</span><span class="p">)]</span>

<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories_subset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that we saved the subsetted data as a separate object here. What do you think would happen if we saved <code class="docutils literal notranslate"><span class="pre">tetrismemories[,c(1,16)]</span></code> to the object name <code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code>?</p>
<p>If we save the subsetted data to the same data frame name, it will overwrite the original data frame. Doing this would mean we can no longer access the data we filtered out, and we’d have to reload the data file to get it back. This process is called <strong>destructive editing</strong>. In general, we don’t want to do this - we don’t want to permanently erase any data. Thus if you’re manipulating data in a data frame, it’s usually best to save the manipulated data as a new object. That way you can always access the original data again if needed. <em>Definitely</em> don’t save manipulated data frames as a csv that replaces the original file you loaded the data from, or you won’t be able to get it back!</p>
<p>The above process works for subsetting variables, but is kind of clunky. You have to manually count column numbers, which is prone to error. What most people do instead is use a package written specifically for making data cleaning easier, called <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> (dee-ply-er).</p>
<p>After we install the <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> package and load it from the library, the <code class="docutils literal notranslate"><span class="pre">select()</span></code> function provides easy syntax for subsetting. When using <code class="docutils literal notranslate"><span class="pre">select()</span></code>, we just need to provide arguments to tell R which data frame to work on (as the first argument) and which variables to select from that data frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">#downloading package from the internet - this may take a few moments</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">             </span><span class="c1">#loading package from library into workspace</span>

<span class="c1">#Make a prediction, what do you think this code will do? </span>
<span class="nf">select</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">intrusive_memories</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You may need to scroll the output up and down to see it all. It’s quite a lot because the function <code class="docutils literal notranslate"><span class="pre">select()</span></code> will print out all the values of the selected variables.</p>
<p>Sometimes you might want to look at a subset of observations, not variables. Notice the first person in the <code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code> dataframe had 4 instrusive memories over the course of the study. Are they the only person with that many? What happens if we put 4 as an argument in <code class="docutils literal notranslate"><span class="pre">select()</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">select</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">select()</span></code> only works on <em>variables</em> (or columns of the data frame), not values. In this case, since you gave it the number 4 for the second argument, it thought you were asking for the 4th column, so it gave you that.</p>
<p>To get a subset of observations (or rows of the data frame) we use a different <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> function: <code class="docutils literal notranslate"><span class="pre">filter()</span></code>. This function filters the data frame to show only the observations (rows) that match some criteria. For example, here is the code that will return only the observations where the number of memories is 4:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">filter</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">intrusive_memories</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">filter()</span></code>, like <code class="docutils literal notranslate"><span class="pre">select()</span></code>, returns a data frame. In this case, the data frame has ten rows because ten people in the study reported having four intrusive memories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#How would you use filter() to return a data frame of everyone who had *at least* 4 memories?</span>
</pre></div>
</div>
</div>
</div>
<p>One challenge for students is to keep track of the difference between an observation (e.g., participants, represented in rows) and a variable (e.g., <code class="docutils literal notranslate"><span class="pre">condition</span></code> or <code class="docutils literal notranslate"><span class="pre">intrusive_memories</span></code>, represented in columns). It is helpful to imagine the rows and columns of a data frame when you read about observations and variables, respectively. If the data are in a data frame format like this (also known as “tidy”), the rows will always be observations and the columns, variables.</p>
<p>In this course we will be providing most of the data you analyze in a tidy format. However, the world is not always tidy. One day, in the wild world outside of this course, you may have to transform a non-tidy data set into a tidy one.</p>
</section>
<section id="filtering-bad-data">
<h2>4.2 Filtering bad data<a class="headerlink" href="#filtering-bad-data" title="Permalink to this heading">#</a></h2>
<p>Filtering is very useful for removing data points we don’t want, such as the bad outliers and missing values discussed in chapter 2. To remove outliers, we need to decide what counts as realistic values for a variable. There are different opinions on this among researchers. Some believe you should remove any data points that are sufficiently far away from the average of a variable (chapter 5 will discuss ways to calculate this). Other researchers are more conservative and think you should only remove data points if the value is clearly incorrect, like someone mistyping their age as 211 instead of 21. This is an example of a situation where statistics aren’t completely objective, and different decisions lead to different analysis outcomes. You will have to develop domain knowledge in the topic you are studying in order to be confident that the decision you made on outlier classification is the best decision for your data.</p>
<p>Let’s say for our purposes that it wouldn’t be realistic for anyone to have more than 100 intrusive memories during the tetris study (that would be at least 10 per day). Thus if an observation has a value of &gt;100 in <code class="docutils literal notranslate"><span class="pre">instrusive_memories</span></code>, we want to exclude it as bad data. Write code below to create a new data frame that excludes anyone with more than 100 reported intrusive memories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="c1">#your code here)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">filter()</span></code> filters <em>in</em>, so the filtering criteria should apply to all the data points you want to keep. So your code above should be using <code class="docutils literal notranslate"><span class="pre">intrusive_memories</span> <span class="pre">&lt;=</span> <span class="pre">100</span></code> as the filtering criteria to exclude people with unrealistic values.</p>
<p>Got it working? Let’s see how many people we filtered out by comparing the length of this cleaned dataset to the original raw data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">nrow</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">)</span>
<span class="nf">nrow</span><span class="p">(</span><span class="n">tetrismemories_clean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looks like everyone had valid values on <code class="docutils literal notranslate"><span class="pre">intrusive_memories</span></code>, because we did not remove anyone based on our exclusion criteria for that variable.</p>
<p>There are other reasons you might exclude data. For instance, was a person with 2 intrusive memories less affected by the traumatic videos? Or did they only record information in their diary for a couple days? We probably want to exclude people who did not comply with the study instructions for the majority of the time (say, 8+ days of diary entry). So let’s filter our dataset to exclude anyone with too few days:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">diary_compliance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>

<span class="nf">nrow</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">)</span>
<span class="nf">nrow</span><span class="p">(</span><span class="n">tetrismemories_clean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Using this approach, we removed 12 participants for poor complaince.</p>
<p>Another reason to exclude observations from a dataset is because of missing values. It is very common in psychology to have at least a few missing values somewhere. In a data file, this would likely look like a blank cell where a value should otherwise be. When loaded into R, blank cells are represented with the value NA (“not available”). If your data set represents missing data in some other way (e.g., some people put a nonsense value like -999), you should recode the values as NA when working in R (recoding will be discussed later in this chapter).</p>
<p>Let’s consider the <code class="docutils literal notranslate"><span class="pre">tetris_total_score</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code> data frame. First, a function called <code class="docutils literal notranslate"><span class="pre">is.na()</span></code> can be used to tell you whether a datapoint is NA or not (it will return <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> or <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>). If we apply that to an entire vector, it will return a vector of falses and trues corresponding to what indices in the vector have an NA value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using is.na() on the tetris_total_score variable to see where NA values might be</span>

<span class="nf">is.na</span><span class="p">(</span><span class="n">tetrismemories</span><span class="o">$</span><span class="n">tetris_total_score</span><span class="p">)</span><span class="w"> </span><span class="c1">#remember variable names are case sensitive!</span>
</pre></div>
</div>
</div>
</div>
<p>Based on this, we can easily see some missing data in this variable - there are <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> results to the question “is this datapoint NA?”</p>
<p>Now that you can find missing data, the big question is - what to do about it? Again, there are different opinions. Most commonly, researchers just remove observations with values missing on important variables. There’s also something called imputation, which involves figuring out what the missing value most likely is and inserting that value into the dataset. For this exercise, we will use the exclusion method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">filter</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">tetris_total_score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;NA&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Can you remember what the <code class="docutils literal notranslate"><span class="pre">!=</span></code> operator does? This code returns a data frame that includes only cases for which the variable <code class="docutils literal notranslate"><span class="pre">tetris_total_score</span></code> is <em>not</em> equal to NA.</p>
</section>
<section id="creating-new-variables">
<h2>4.3 Creating new variables<a class="headerlink" href="#creating-new-variables" title="Permalink to this heading">#</a></h2>
<p>Often we use multiple measures of a single attribute because no single measure would be adequate. As we talked about in chapter 2, aggregating over multiple measurements can help with measurement error, such as surveys with multiple related questions or behavioral studies with multiple trials.</p>
<p>If you do have multiple measures of one thing in a dataset, you will want to combine them into a single variable. For example, in <code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code>, participants gave ratings for how strongly they felt various negative emotions before and after video watching, on a scale from 0 to 10. These values are recorded in the <code class="docutils literal notranslate"><span class="pre">pre_sad_rating</span></code>, <code class="docutils literal notranslate"><span class="pre">pre_hopeless_rating</span></code>, <code class="docutils literal notranslate"><span class="pre">pre_depressed_rating</span></code>, <code class="docutils literal notranslate"><span class="pre">pre_fear_rating</span></code>, <code class="docutils literal notranslate"><span class="pre">pre_horror_rating</span></code>, and <code class="docutils literal notranslate"><span class="pre">pre_anxious_rating</span></code> (and corresponding variables for the post ratings). If we have a hypothesis about different video conditions inducing more negative affect in general, we may want to sum up these scores into one combined negative affect variable.</p>
<p>To do so, we create a new variable in a data frame using values from these original variables. The <code class="docutils literal notranslate"><span class="pre">mutate()</span></code> function in R mutates a data frame to include added or changed columns. The first argument is again the data frame to mutate, and then we define a new variable name and how it is computed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">pre_negative_affect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_sad_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_hopeless_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_depressed_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">    </span><span class="n">pre_fear_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_horror_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_anxious_rating</span><span class="p">)</span>

<span class="c1">#If a line of code is really long, hitting return will make it wrap onto the next line. </span>
<span class="c1">#It is still evaluated as one line of code. </span>
</pre></div>
</div>
</div>
</div>
<p>If the new variable created with <code class="docutils literal notranslate"><span class="pre">mutate()</span></code> already exists in the data frame, R will overwrite it with these new values. If it doesn’t, <code class="docutils literal notranslate"><span class="pre">mutate()</span></code> will create a new variable and append it as a new column to the end of the mutated data frame.</p>
<p>Other reasons you might create a new variable is because you want to represent an existing variable in a different way. For example, in <code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code>, participants reported the total number of intrusive memories they experienced (<code class="docutils literal notranslate"><span class="pre">intrusive_memories</span></code>) over a certain number of days they kept track for (<code class="docutils literal notranslate"><span class="pre">diary_compliance</span></code>). We don’t know how many memories per day they were having on average, but we could calculate this by dividing <code class="docutils literal notranslate"><span class="pre">intrusive_memories</span></code> by <code class="docutils literal notranslate"><span class="pre">diary_compliance</span></code> to make a new variable <code class="docutils literal notranslate"><span class="pre">memory_rate</span></code>. Try it yourself in the code block below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="c1">#your code here)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dplyr</span></code> and its functions are very popular among R coders because of their easy syntax when working with tidy data. In fact this package is among those colloquially called the “tidyverse”, a name you might come across while googling R functions. But like with <code class="docutils literal notranslate"><span class="pre">subset()</span></code> and <code class="docutils literal notranslate"><span class="pre">filter()</span></code>, there is also a way to create new variables without downloading <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> functions (using what’s called “base R”). The base R version of creating new variables is to reference a new variable name using the <code class="docutils literal notranslate"><span class="pre">$</span></code> operator we learned last chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># making a new memory_rate variable using the base R approach</span>
<span class="n">tetrismemories_clean</span><span class="o">$</span><span class="n">memory_rate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tetrismemories</span><span class="o">$</span><span class="n">instrusive_memories</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">tetrismemories</span><span class="o">$</span><span class="n">diary_compliance</span>
<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As we learn more R, you will often find that there are multiple ways to do the same thing. Neither the tidyverse approach or the base R approach is more correct than the other. Like linguistic quirks in spoken language, your choice of method will just depend on the way that is easier for you to remember or how you prefer to “say” things in code.</p>
<div class="alert alert-block alert-info">
<b>Note</b>: Are we learning too many functions to memorize? Create a "cheatsheet" or page of notes for keeping track of R functions and how to use them.
</div></section>
<section id="recoding-variables">
<h2>4.4 Recoding variables<a class="headerlink" href="#recoding-variables" title="Permalink to this heading">#</a></h2>
<p>Another very common step in data cleaning is changing the values or data types used to represent variables. Changing these values is called <strong>recoding</strong> a variable. For instance, the variable <code class="docutils literal notranslate"><span class="pre">condition</span></code> is coded 1-4, depending on which condition a participant was in:</p>
<ol class="arabic simple">
<li><p>No-task control: These participants completed a 10-minute music filler task.</p></li>
<li><p>Reactivation + Tetris: These participants were shown a series of images from the trauma film to
reactivate the traumatic memories (i.e., reactivation task). After a 10-minute music filler task,
participants played the video game Tetris for 12 minutes.</p></li>
<li><p>Tetris Only: These participants played Tetris for 12 minutes, but did not complete the reactivation
task.</p></li>
<li><p>Reactivation Only: These participants completed the reactivation task, but did not play Tetris.</p></li>
</ol>
<p>These data are currently stored as numbers. But since these numbers represent study conditions, the variable’s scale of measurement is inherently categorical. Thus we probably want to transform this variable into character labels that are easier to remember the meaning of. What happens if we simply convert the <code class="docutils literal notranslate"><span class="pre">condition</span></code> variable to a character data type?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_recoded</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tetrismemories</span><span class="w"> </span><span class="c1">#avoiding destructive editing by making a new copy of data frame</span>
<span class="nf">str</span><span class="p">(</span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span>

<span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">tetrismemories</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span>

<span class="c1">#or the tidyverse way with a function inside a function:</span>
<span class="c1"># mutate(tetrismemories, condition = as.character(condition))</span>
</pre></div>
</div>
</div>
</div>
<p>This makes the <code class="docutils literal notranslate"><span class="pre">condition</span></code> variable a character type, but the number labels still aren’t very descriptive. Let’s go further, and change those actual values into words that are easier to understand. In base R, you could set up a for loop and several if/else statements to change these values based on the current labels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_recoded</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tetrismemories</span><span class="w"> </span><span class="c1">#avoiding destructive editing by making a new copy of data frame</span>

<span class="nf">for </span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">tetrismemories_recoded</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&#39;control&#39;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&#39;reactivation_tetris&#39;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&#39;tetris&#39;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&#39;reactivation&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">tetrismemories_recoded</span><span class="o">$</span><span class="n">condition</span>
</pre></div>
</div>
</div>
</div>
<p>Whew, that was a lot! Alternatively, <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> has a function that handles all that control flow for you under the hood, making it much easier to write the code. This function is <code class="docutils literal notranslate"><span class="pre">case_match()</span></code>. As the first argument, <code class="docutils literal notranslate"><span class="pre">case_match()</span></code> takes a variable you want to modify. The remaining arguments are mapping specification for which values should turn into which other values, separated by a <code class="docutils literal notranslate"><span class="pre">~</span></code> symbol. When combined with <code class="docutils literal notranslate"><span class="pre">mutate()</span></code> using a <strong>nested function</strong> (one function creating the argument for another from the inside) we can modify an existing variable to have new labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_match</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;control&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">#existing value ~ new value</span>
<span class="w">                                                        </span><span class="m">2</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;reactivation_tetris&#39;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="m">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;tetris&#39;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="m">4</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;reactivation&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="combining-multiple-cleaning-steps">
<h2>4.5 Combining multiple cleaning steps<a class="headerlink" href="#combining-multiple-cleaning-steps" title="Permalink to this heading">#</a></h2>
<p>Cleaning a dataset is rarely simple. Often we need to do multiple of the steps described above such as subsetting, filtering, creating new variables, and/or recoding. One could feasibly write a new line of code for each step, defining a new data frame object each time in order to avoid destructive editing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">diary_compliance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>

<span class="n">tetrismemories3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories2</span><span class="p">,</span><span class="w"> </span><span class="n">pre_negative_affect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pre_sad_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_hopeless_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_depressed_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">    </span><span class="n">pre_fear_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_horror_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pre_anxious_rating</span><span class="p">)</span>

<span class="n">tetrismemories4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories3</span><span class="p">,</span><span class="w"> </span><span class="n">post_negative_affect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post_sad_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">post_hopeless_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">post_depressed_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">    </span><span class="n">post_fear_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">post_horror_rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">post_anxious_rating</span><span class="p">)</span>

<span class="n">tetrismemories5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories4</span><span class="p">,</span><span class="w"> </span><span class="n">negative_affect_change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post_negative_affect</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pre_negative_affect</span><span class="p">)</span>

<span class="n">tetrismemories6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="n">tetrismemories5</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_match</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;control&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                                        </span><span class="m">2</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;reactivation_tetris&#39;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="m">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;tetris&#39;</span><span class="p">,</span>
<span class="w">                                                        </span><span class="m">4</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&#39;reactivation&#39;</span><span class="p">))</span>

<span class="n">tetrismemories7</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">tetrismemories6</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">intrusive_memories</span><span class="p">,</span><span class="w"> </span><span class="n">negative_affect_change</span><span class="p">)</span>

<span class="c1">#What cleaning steps are done by each line of code?</span>

<span class="c1">#looking at raw vs. cleaned data</span>
<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This works, but isn’t best practice for a couple reasons. First, there are now several data frames stored in the R workspace. It can be hard for you as the researcher to remember which is which. Second, especially when data frames a large, storing this many data frames at once can cause your computer to run out of memory.</p>
<p>A better approach is to combine multiple cleaning steps into one object declaration call. We could use nested functions like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#inside filter function creates a value that is used as the first argument to outer select() function</span>
<span class="n">tetrismemories_clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">tetrismemories</span><span class="p">,</span><span class="w"> </span><span class="n">diary_compliance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">intrusive_memories</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>But that gets difficult to read if there are more than a couple levels to the nesting.</p>
<p>To solve this issue, the <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> packages provides functionality for a new operator that looks like <code class="docutils literal notranslate"><span class="pre">%&gt;%</span></code>. This is called a <strong>pipe</strong>. Piping lets you pass the output of one function immediately as an argument to another without the need to define an intermediate data frame object. Doing the same command above with a pipe looks like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tetrismemories</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                        </span><span class="nf">filter</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">diary_compliance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">                        </span><span class="nf">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">intrusive_memories</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories_clean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Chaining functions together with a pipe is easier for a human to read (and thus use and debug). The first item in the chain (<code class="docutils literal notranslate"><span class="pre">tetrismemories</span></code>) is the object you want to start operating on. That object is piped in as the argument of the next function denoted with a <code class="docutils literal notranslate"><span class="pre">.</span></code>. The output of that function is further piped in as an argument in the next function, and so on. Putting these piping steps on separate lines makes it further easier to read. Finally, this whole chain is saved to a data frame object which will hold the final resulting value.</p>
<div class="alert alert-block alert-info">
<b>Note</b>: If the argument you are piping into is the first one, you don't need to include a dot at all as a placeholder - you can simply leave out the first argument in the function call. R programmers frequently do this. If the argument is anything besides the first, the dot is needed. In this course we will always include the dot as a way to more explicitly keep track of what argument is being piped into.
</div>
<p>In the code block below, try it out yourself by adding a step that recodes the <code class="docutils literal notranslate"><span class="pre">condition</span></code> variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tetrismemories_clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tetrismemories</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                        </span><span class="nf">filter</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">diary_compliance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">                        </span><span class="c1">#add a step here, followed by a pipe</span>
<span class="w">                        </span><span class="nf">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">intrusive_memories</span><span class="p">)</span>

<span class="nf">head</span><span class="p">(</span><span class="n">tetrismemories_clean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-info">
<b>Note</b>: Base R has its own version of the pipe, |>. It works very similarly to the %>% pipe in dplyr, except it can't pipe into any argument position besides the first one. For this reason %>% is more flexible, but you do need to load the dplyr library to use it.
</div></section>
<section id="saving-data">
<h2>4.6 Saving data<a class="headerlink" href="#saving-data" title="Permalink to this heading">#</a></h2>
<p>The majority of data projects you will ever work on will involve some data manipulation steps like this. We often do this to fix problems with raw data files or arrange things in a way that will give us easier time later in analysis. We’ve already mentioned how data cleaning is an important step, but it’s worth repeating again. While we are only spending one chapter dedicated to this in this course, you will actually find (maybe to some <a class="reference external" href="https://www.quora.com/Why-do-people-state-that-the-majority-of-work-for-a-data-scientist-is-data-cleaning-not-the-machine-learning-part">frustration</a>) that the majority of time you spend on a data file is cleaning, rather than analyzing. Once you get comfortable with statistics, analysis can be as simple as a few lines of code. But data cleaning can involve many steps and a lot of time figuring out what cleaning steps you even need to take!</p>
<p>For this reason, it is very helpful to save the results of your data cleaning after you’re done. You don’t want to have to go through all that again if you decide later on you want to do a different kind of data analysis.</p>
<p>As we used <code class="docutils literal notranslate"><span class="pre">read.csv()</span></code> to read in data files to R, we can use <code class="docutils literal notranslate"><span class="pre">write.csv()</span></code> to save .csv files of our cleaned data. In its most basic use, it only needs two arguments: the data frame object you wish to save, and a string of the file name you wish to save it as (.csv extension must be included). So if we were to save the results of <code class="docutils literal notranslate"><span class="pre">tetrismemories2</span></code>, we would simply type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#saving a data frame into a csv file</span>
<span class="nf">write.csv</span><span class="p">(</span><span class="n">tetrismemories2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tetrismemories2.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This would create a “tetrismemories2.csv” file in the current working directory. Make sure to save it as a different file name from your raw file so you can always refer back to the original if needed (no destructive editing!).</p>
</section>
<section id="chapter-summary">
<h2>Chapter summary<a class="headerlink" href="#chapter-summary" title="Permalink to this heading">#</a></h2>
<p>After reading this chapter, you should be able to:</p>
<ul class="simple">
<li><p>Explain why we would do the common data cleaning processes of subsetting, filtering, creating new variables, and recoding.</p></li>
<li><p>Subset a data frame with code</p></li>
<li><p>Filter a data frame code</p></li>
<li><p>Add a new variable to a dataframe and change an existing one</p></li>
<li><p>Recode a variable to new data types or values</p></li>
<li><p>String multiple data cleaning steps together with pipes</p></li>
<li><p>Save a dataframe to a new file</p></li>
</ul>
</section>
<section id="new-concepts">
<h2>New concepts<a class="headerlink" href="#new-concepts" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>data cleaning</strong>: Ahe process of identifying and fixing errors in a dataset, and reformatting the dataset to be more analysis-compliant.</p></li>
<li><p><strong>destructive editing</strong>: An editing practice where the original copy of a file is overwritten by an edited copy, destroying the original.</p></li>
<li><p><strong>pipe</strong>: An operator in R that allows a coder to pass the output of one function immediately as an argument in another.</p></li>
</ul>
<p><a class="reference external" href="https://colab.research.google.com/github/smburns47/Psyc158/blob/main/chapter-5.ipynb">Next: Chapter 5 - Describing Data</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "smburns47/Psyc158",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subsetting-data">4.1 Subsetting data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-bad-data">4.2 Filtering bad data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-variables">4.3 Creating new variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recoding-variables">4.4 Recoding variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-multiple-cleaning-steps">4.5 Combining multiple cleaning steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-data">4.6 Saving data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chapter-summary">Chapter summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-concepts">New concepts</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Shannon Burns
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>